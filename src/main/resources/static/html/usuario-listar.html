<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Usuário Lista</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
		crossorigin="anonymous" />
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/json2html/2.1.0/json2html.min.js"></script>


	<script>

		$(document).ready(function () {

			listarUsuario();

		});


		function listarUsuario() {
			var endpoint = "http://localhost:8080/usuario";

			var header = {
				method: 'GET',
				header: { 'Content-type': 'application/json' }
			};

			fetch(endpoint, header)
				.then(response => response.json())
				.then(data => {

					data.forEach(usuario => {
						var conteudo =
							"<tr>" +
							"<td><a href='usuario-editar.html?idUsuario=" + usuario.idUsuario + "'>" + usuario.idUsuario + "</a></td>" +
							"<td>" + usuario.nome + "</td>" +
							"<td>" + usuario.email + "</td>" +
							"<td>" + usuario.idade + "</td>" +
							"<td><a href='javascript:excluirUsuario(" + usuario.idUsuario + ");' >Excluir</a></td>" +
							"</tr>";

						$("#tabelaUsuario>tbody").append(conteudo);
					});

				})
				.catch(erro => alert('Problemas no GET da API'));
		}


		function excluirUsuario(id) {

			var endpoint = "http://localhost:8080/usuario/" + id;

			var header = {
				method: 'DELETE',
				headers: {
					'Content-type': 'application/json; charset=UTF-8'
				}
			};

			fetch(endpoint, header)
				.then(function (response) {
					if (response.ok) {
						$("#tabelaUsuario>tbody").empty();
						listarUsuario();
					} else {
						alert('Não foi possível remover o usuário')
					}
				});

		}


	</script>

</head>





<body>



	<div class="container">
		<main role="main" class="pb-3">
			<div class="col-md-12">
				<h1>Usuários</h1>
				<a href="usuario-novo.html" class="btn btn-primary btn-lg">Novo</a>

				<table id="tabelaUsuario" class="table table-striped" border="1" cellspacing="0" cellpadding="0">
					<thead>
						<tr>
							<th data-field="id">Id</th>
							<th data-field="nome">Nome</th>
							<th data-field="email">Email</th>
							<th data-field="idade">Idade</th>
							<th data-field="acao">Ação</th>
						</tr>
					</thead>
					<tbody>

					</tbody>
				</table>
			</div>
		</main>
	</div>



	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js"></script>
</body>


</html>